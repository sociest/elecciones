---
import Layout from "../layouts/Layout.astro";
import { buildPath } from "../lib/utils/paths";

const title = "Página no encontrada - 404";
const description = "La página que buscas no existe o ha sido movida.";
---

<Layout title={title} description={description}>
    <main
        class="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center px-4"
    >
        <div class="max-w-2xl w-full text-center">
            <!-- Número 404 grande -->
            <div class="mb-8">
                <h1
                    class="text-9xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400"
                >
                    404
                </h1>
            </div>

            <!-- Mensaje principal -->
            <div class="mb-8">
                <h2
                    class="text-3xl font-bold text-gray-900 dark:text-white mb-4"
                >
                    Página no encontrada
                </h2>
                <p class="text-lg text-gray-600 dark:text-gray-300 mb-2">
                    Lo sentimos, la página que buscas no existe o ha sido
                    movida.
                </p>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                    Verifica la URL o regresa a la página principal.
                </p>
            </div>

            <!-- Ilustración SVG -->
            <div class="mb-12 flex justify-center">
                <svg
                    class="w-64 h-64 text-gray-400 dark:text-gray-600"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.5"
                        d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                </svg>
            </div>

            <!-- Botones de acción -->
            <div
                class="flex flex-col sm:flex-row gap-4 justify-center items-center"
            >
                <a
                    href={buildPath("/")}
                    class="inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-lg hover:shadow-xl"
                >
                    <svg
                        class="w-5 h-5 mr-2"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                        ></path>
                    </svg>
                    Ir al inicio
                </a>

                <a
                    href={buildPath("/search")}
                    class="inline-flex items-center px-6 py-3 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-900 dark:text-white font-medium rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg border border-gray-200 dark:border-gray-700"
                >
                    <svg
                        class="w-5 h-5 mr-2"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                        ></path>
                    </svg>
                    Buscar
                </a>

                <button
                    onclick="history.back()"
                    class="inline-flex items-center px-6 py-3 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-900 dark:text-white font-medium rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg border border-gray-200 dark:border-gray-700"
                >
                    <svg
                        class="w-5 h-5 mr-2"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Volver atrás
                </button>
            </div>

            <!-- Enlaces útiles -->
            <div
                class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700"
            >
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
                    También puedes explorar:
                </p>
                <div class="flex flex-wrap gap-3 justify-center">
                    <a
                        href={buildPath("/mapa")}
                        class="text-sm text-blue-600 dark:text-blue-400 hover:underline"
                    >
                        Mapa
                    </a>
                    <span class="text-gray-300 dark:text-gray-600">•</span>
                    <a
                        href={buildPath("/search")}
                        class="text-sm text-blue-600 dark:text-blue-400 hover:underline"
                    >
                        Búsqueda
                    </a>
                </div>
            </div>
        </div>
    </main>
</Layout>

<script>
    // Redirigir automáticamente si la ruta no contiene el base path
    (function () {
        const basePath = import.meta.env.BASE_URL || "/front-graph";
        const currentPath = window.location.pathname;
        const currentSearch = window.location.search;
        const currentHash = window.location.hash;

        // Log para debugging
        if (import.meta.env.DEV) {
            console.log("404 Page - Current path:", currentPath);
            console.log("404 Page - Base path:", basePath);
        }

        // Verificar si la ruta empieza con /onboarding/, /search, /mapa, etc sin el base path
        const routesWithoutBase = [
            "/onboarding/",
            "/search",
            "/mapa",
            "/entity",
            "/test-404",
            "/test-params",
        ];
        const isRouteWithoutBase = routesWithoutBase.some(
            (route) => currentPath === route || currentPath.startsWith(route),
        );

        // Si encontramos una ruta sin el base path, redirigir
        if (isRouteWithoutBase && !currentPath.startsWith(basePath)) {
            const newPath = basePath.replace(/\/$/, "") + currentPath; // Evitar doble slash
            const newUrl = newPath + currentSearch + currentHash;

            if (import.meta.env.DEV) {
                console.log("Redirecting from:", currentPath);
                console.log("Redirecting to:", newUrl);
            }

            window.location.replace(newUrl);
        }
    })();
</script>
